$(function(){function a(){var a=function(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}}(),b=$.fn.on;$.fn.on=function(){if(/click/.test(arguments[0])&&"function"==typeof arguments[1]&&a){var c,d=arguments[1];b.apply(this,["touchstart",function(a){c=a.changedTouches[0].clientY}]),b.apply(this,["touchend",function(a){Math.abs(a.changedTouches[0].clientY-c)>10||(a.preventDefault(),d.apply(this,[a]))}])}else b.apply(this,arguments);return this}}function b(){/Android/gi.test(navigator.userAgent)&&window.addEventListener("resize",function(){"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName||window.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0)})}function c(){for(var a={},b=$('script[type="text/html"]'),c=$(window).height(),d=0,f=b.length;d<f;++d){var g=b[d],h=g.id.replace(/tpl_/,"");a[h]={name:h,url:"#"+h,template:"#"+g.id}}a.home.url="#";for(var i in a)e.push(a[i]);e.setPageAppend(function(a){var b=a.find(".page__ft");b.length<1||(b.position().top+b.height()<c?b.addClass("j_bottom"):b.removeClass("j_bottom"))}).setDefault("home").init()}function d(){a(),b(),c(),window.pageManager=e,window.home=function(){location.hash=""}}var e={$container:$("#container"),_pageStack:[],_configs:[],_pageAppend:function(){},_defaultPage:null,_pageIndex:1,pageOther:null,searchAux:null,setDefault:function(a){return this._defaultPage=this._find("name",a),this},setPageAppend:function(a){return this._pageAppend=a,this},init:function(){var a=this;$(window).on("hashchange",function(){var b=history.state||{},c=0===location.hash.indexOf("#")?location.hash:"#",d=a._find("url",c)||a._defaultPage;b._pageIndex<=a._pageIndex||a._findInStack(c)?a._back(d):a._go(d)}),history.state&&history.state._pageIndex&&(this._pageIndex=history.state._pageIndex),this._pageIndex--;var b=0===location.hash.indexOf("#")?location.hash:"#",c=a._find("url",b)||a._defaultPage;return this._go(c),this},push:function(a){return this._configs.push(a),this},go:function(a){this.pageOther=null;var b=this._find("name",a);b&&(location.hash=b.url,arguments.length>1&&(this.pageOther=arguments[1]))},_go:function(a){this._pageIndex++,history.replaceState&&history.replaceState({_pageIndex:this._pageIndex},"",location.href);var b=$(a.template).html(),c=$(b).addClass("slideIn").addClass(a.name);return c.on("animationend webkitAnimationEnd",function(){c.removeClass("slideIn").addClass("js_show")}),this.$container.append(c),this._pageAppend.call(this,c),this._pageStack.push({config:a,dom:c}),a.isBind||this._bind(a),this},back:function(){history.back(),this.pageOther=null},_back:function(a){this._pageIndex--;var b=this._pageStack.pop();if(b){var c=0===location.hash.indexOf("#")?location.hash:"#";if(!this._findInStack(c)){var d=$(a.template).html(),e=$(d).addClass("js_show").addClass(a.name);e.insertBefore(b.dom),a.isBind||this._bind(a),this._pageStack.push({config:a,dom:e})}return b.dom.addClass("slideOut").on("animationend webkitAnimationEnd",function(){b.dom.remove()}),this}},_findInStack:function(a){for(var b=null,c=0,d=this._pageStack.length;c<d;c++){var e=this._pageStack[c];if(e.config.url===a){b=e;break}}return b},_find:function(a,b){for(var c=null,d=0,e=this._configs.length;d<e;d++)if(this._configs[d][a]===b){c=this._configs[d];break}return c},_bind:function(a){var b=a.events||{};for(var c in b)for(var d in b[c])this.$container.on(d,c,b[c][d]);a.isBind=!0}};d()});