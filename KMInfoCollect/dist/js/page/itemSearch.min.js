$(function(){function a(){f.hide(),e.removeClass("weui-search-bar_focusing"),h.val(""),$("#keyword").text(""),g.hide()}function b(){a(),e.removeClass("weui-search-bar_focusing")}function c(a,b,c){var d={};d.userName=store.get("loginName"),d.password=store.get("password"),d[b]=c,$.ajax({url:$kmurl+a,type:"GET",contentType:"application/json;charset=utf-8",dataType:"jsonp",jsonp:"jsoncallback",data:{parms:JSON.stringify(d)},success:function(a){if("success"!=a.result||isEmpty(JSON.parse(a.message)))f.html("").hide(),$("#keyword").text($.trim(h.val())),g.show();else{var c=JSON.parse(a.message),d="";f.html(""),$.each(c,function(a,c){switch(b){case"market":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.market_id+'" data-name="'+c.market_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.market_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"medicine":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.medicine_id+'" data-name="'+c.medicine_name+'" data-standard="'+c.standard+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.medicine_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"cmedicine":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.medicine_id+'" data-name="'+c.medicine_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.medicine_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"base":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.base_id+'" data-name="'+c.base_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.base_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"grower":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.grower_id+'" data-name="'+c.grower_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.grower_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"manufacturer":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.manufacturer_id+'" data-name="'+c.manufacturer_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.manufacturer_name+'</p></div><div class="weui-cell__ft"></div></a>'}}),g.hide(),f.html(d).show();var e=parseInt($(".itemSearch").height());parseInt($("#searchResult").height())+45>=e&&$("#searchResult").on("touchmove",function(a){a.stopPropagation()})}},error:function(a,b,c){f.html("").hide(),console.log("输入参数错误，请核对！"),$("#keyword").text($.trim(h.val())),g.show()}})}innerInit(),$(".itemSearch").on("touchmove",function(a){a.preventDefault()});var d=function(a){var b="";switch(a){case"market":b="请输入市场名称搜索";break;case"medicine":b="请输入中药材名称搜索";break;case"cmedicine":b="请输入转产药材名称搜索";break;case"base":b="请输入产地名称搜索";break;case"grower":b="请输入种植户搜索";break;case"manufacturer":b="请输入生产商名称搜索"}return b},e=$("#searchBar"),f=$("#searchResult"),g=$("#searchNothing"),h=$("#searchInput"),i=$("#searchClear"),j=$("#searchCancel"),k="";k=store.get("getSearch")?store.get("getSearch"):"",h.attr("placeholder",d(k));var l=function(a){var b="";switch(a){case"market":b="/likeMarket";break;case"medicine":case"cmedicine":b="/likeMedicine";break;case"base":b="/likeBase";break;case"grower":b="/likeGrower";break;case"manufacturer":b="/likeManufacturer"}return b},m=function(){var a;return function(b){a||(a=setTimeout(function(){"cmedicine"==k?c(l(k),"medicine",$.trim(h.val())):c(l(k),k,$.trim(h.val())),clearTimeout(a),a=null},1e3))}}();f.on("click",".searchbar-item",function(a){if(stopBubble(a),a.preventDefault(),window.pageManager){var b={id:$(this).data("id"),name:$(this).data("name"),standard:$(this).data("standard")?$(this).data("standard"):""};store.remove(k),store.set(k,JSON.stringify(b)),window.pageManager.back(k)}}),h.on("blur",function(){this.value.length||b()}).on("input propertychange",function(){this.value.length?(e.addClass("weui-search-bar_focusing"),m()):f.hide()}),i.on("click",function(){a(),h.focus()}),j.on("click",function(){b(),h.blur()})});