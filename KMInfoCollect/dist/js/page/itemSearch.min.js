$(function(){function a(){e.hide(),d.removeClass("weui-search-bar_focusing"),g.val(""),$("#keyword").text(""),f.hide()}function b(){a(),d.removeClass("weui-search-bar_focusing")}function c(a,b,c){var d={};d.userName=store.get("loginName"),d.password=store.get("password"),d[b]=c,$.ajax({url:$kmurl+a,type:"GET",contentType:"application/json;charset=utf-8",dataType:"jsonp",jsonp:"jsoncallback",data:{parms:JSON.stringify(d)},success:function(a){if("success"!=a.result||isEmpty(JSON.parse(a.message)))$("#keyword").text($.trim(g.val())),f.show();else{var c=JSON.parse(a.message),d="";e.html(""),$.each(c,function(a,c){switch(b){case"market":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.market_id+'" data-name="'+c.market_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.market_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"medicine":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.medicine_id+'" data-name="'+c.medicine_name+'" data-standard="'+c.standard+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.medicine_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"cmedicine":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.medicine_id+'" data-name="'+c.medicine_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.medicine_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"base":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.base_id+'" data-name="'+c.base_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.base_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"grower":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.grower_id+'" data-name="'+c.grower_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.grower_name+'</p></div><div class="weui-cell__ft"></div></a>';break;case"manufacturer":d+='<a class="weui-cell weui-cell_access searchbar-item" data-id="'+c.manufacturer_id+'" data-name="'+c.manufacturer_name+'"  href="javascript:;"><div class="weui-cell__bd weui-cell_primary"><p>'+c.manufacturer_name+'</p></div><div class="weui-cell__ft"></div></a>'}}),f.hide(),e.html(d).show();var h=parseInt($(".itemSearch").height());parseInt($("#searchResult").height())+45>=h&&$("#searchResult").on("touchmove",function(a){a.stopPropagation()})}},error:function(a,b,c){console.log("输入参数错误，请核对！"),$("#keyword").text($.trim(g.val())),f.show()}})}innerInit(),$(".itemSearch").on("touchmove",function(a){a.preventDefault()});var d=$("#searchBar"),e=$("#searchResult"),f=$("#searchNothing"),g=$("#searchInput"),h=$("#searchClear"),i=$("#searchCancel"),j="";j=store.get("getSearch")?store.get("getSearch"):"";var k=function(a){var b="";switch(a){case"market":b="/likeMarket";break;case"medicine":case"cmedicine":b="/likeMedicine";break;case"base":b="/likeBase";break;case"grower":b="/likeGrower";break;case"manufacturer":b="/likeManufacturer"}return b},l=function(){var a;return function(b){a||(a=setTimeout(function(){"cmedicine"==j?c(k(j),"medicine",$.trim(g.val())):c(k(j),j,$.trim(g.val())),clearTimeout(a),a=null},1e3))}}();e.on("click",".searchbar-item",function(a){if(stopBubble(a),a.preventDefault(),window.pageManager){var b={id:$(this).data("id"),name:$(this).data("name"),standard:$(this).data("standard")?$(this).data("standard"):""};store.remove(j),store.set(j,JSON.stringify(b)),window.pageManager.back(j)}}),g.on("blur",function(){this.value.length||b()}).on("input propertychange",function(){this.value.length?(d.addClass("weui-search-bar_focusing"),l()):e.hide()}),h.on("click",function(){a(),g.focus()}),i.on("click",function(){b(),g.blur()})});